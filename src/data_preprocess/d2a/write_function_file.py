# %%
import os
import json

# %%
path = '/home/mdrahman/Desktop/pronto/SliceLevelVulnerabilityDetection/' # path of the project directory


# %%
def read_data(path_):
    f = open(path_, 'r')
    data = []
    for  line in f:
        try:
            data.append(json.loads(line.strip()))
        except Exception as e:
            print(e)
    f.close()
    return data

# %%
import shutil
def check_and_make_dir(path_):
    dirs_ = path_.split()
    path = ''
    for folder in dirs_:
        path = os.path.join(path, folder)
        if not os.path.exists(path):
            os.makedirs(path)

# %%
def write_function(file_path, func):
    f = open(file_path, 'w')
    f.write(func)
    f.close()

# %%
data_path = os.path.join(path, 'data/D2A/')
for project in os.listdir(data_path):

    vul_path = os.path.join(data_path, 'balanced_jsonl', project, 'vul.jsonl')
    non_vul_path = os.path.join(data_path, 'balanced_jsonl', project, 'vul.jsonl')

    for sample in read_data(vul_path) + read_data(non_vul_path):
        folder_path = os.path.join(data_path, 'program_data',  str(sample['target']), project)
        check_and_make_dir(folder_path)
        file_path = os.path.join(folder_path, '{}.c'.format(sample['idx']))
        write_function(file_path, sample['func'])
    




