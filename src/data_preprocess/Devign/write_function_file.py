# -*- coding: utf-8 -*-
import os
import json

# %%
path = '/work/LAS/weile-lab/mdrahman/SliceLevelVulnerabilityDetection'

# %%
def read_data(path_):
    f = open(path_, 'r')
    data = []
    for  line in f:
        try:
            data.append(json.loads(line.strip()))
        except Exception as e:
            print(e)
    f.close()
    return data

# %%
import shutil
def check_and_make_dir(path_):
    dirs_ = path_.split()
    path = ''
    for folder in dirs_:
        path = os.path.join(path, folder)
        if not os.path.exists(path):
            os.makedirs(path)

# %%
cnt = 0
data_path = os.path.join(path, 'data/Devign')
for split in ('train', 'test', 'valid'):
    split_path = os.path.join(data_path, 'jsonl', '{}_diff.jsonl'.format(split))
    for sample in read_data(split_path):
        cnt += 1
        folder_path = os.path.join(data_path, 'program_data', 'data_{}'.format(cnt % 10),   'data_{}'.format(cnt % 10), 'data_{}'.format(cnt % 10))
        check_and_make_dir(folder_path)
        file_path = os.path.join(folder_path, '{}_{}_{}.c'.format(sample['project'], sample['idx'], sample['target']))
        f = open(file_path, 'w')
        f.write(sample['func'].encode('utf-8'))
        f.close()

printf("Success")