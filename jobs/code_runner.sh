#!/bin/bash
export PYTHONPATH=/work/LAS/weile-lab/mdrahman/VulDet/py_joern/python-joern-0.3.1/:${PYTHONPATH}
export PYTHONPATH=/work/LAS/weile-lab/mdrahman/VulDet/py2neo-2.0/:${PYTHONPATH}
export PYTHONPATH=/work/LAS/weile-lab/mdrahman/VulDet/py-igraph/:${PYTHONPATH}
source /work/LAS/weile-lab/mdrahman/VulDet/GNN-ReGVD/env/bin/activate
sbatch << EOT
#!/bin/bash
#SBATCH --nodes=1
#SBATCH --cpus-per-task=4
#SBATCH --mem=16G
#SBATCH --time=20:00:00
#SBATCH --output="/work/LAS/weile-lab/mdrahman/SliceLevelVulnerabilityDetection/jobs/logs/codes/"$1"/code_runner_output_"$2".out"
#SBATCH --error="/work/LAS/weile-lab/mdrahman/SliceLevelVulnerabilityDetection/jobs/logs/codes/"$1"/code_runner_eror_"$2".err"
#SBATCH --job-name="code_"$2
#SBATCH --mail-user=mdrahman@iastate.edu
#SBATCH --mail-type=FAIL,END

#SBATCH --partition=$3
#SBATCH --nodelist=$4

module load openjdk/1.8.0_222-b10-ipodmgy

cd /work/LAS/weile-lab/mdrahman/SliceLevelVulnerabilityDetection/data/$1

python2 /work/LAS/weile-lab/mdrahman/SliceLevelVulnerabilityDetection/src/src2slice/get_cfg_relation.py
python2 /work/LAS/weile-lab/mdrahman/SliceLevelVulnerabilityDetection/src/src2slice/complete_PDG.py
python2 /work/LAS/weile-lab/mdrahman/SliceLevelVulnerabilityDetection/src/src2slice/access_db_operate.py --data data_$2
python2 /work/LAS/weile-lab/mdrahman/SliceLevelVulnerabilityDetection/src/src2slice/points_get.py --data data_$2
python2 /work/LAS/weile-lab/mdrahman/SliceLevelVulnerabilityDetection/src/src2slice/extract_slices.py --data data_$2

EOT
